---
title: "Demostic flight delay in May 2017"
author: Zeping He
subtitle: With the relationship of geographic...
---

# Introduction
With more and more people choose plane to travel, the on-time performace becomes important. I will focus on airline on-time data of May 2017. First, I will test the relationship between "Distance" and "Delay time", I might use ggplot to draw 2D plot. Second, I would like use leaflet to create an interative map shows the Geographical distribution of Airport related to Average delay-time. 
For My hypothsis, I assume distance and delay-time will have a negative relationship. The geographical pattern should be clear to see.

> I know words.  I have the best words.  ~ Donald Trump

# Materials and methods

Narrative and most code will go here.  Describe what you are doing and show how to do it (with code).

You can do bullets like this:

* The first most important thing
* The second most important thing
* The third most important thing

You can do numbers like this:

1. The first most important thing
2. The second most important thing
3. The third most important thing

See [http://rmarkdown.rstudio.com/](http://rmarkdown.rstudio.com/) for all the amazing things you can do.

Load any required packages in a code chunk (you may need to install some packages):
# Data
```{r, message=F, warning=F}
library(dplyr)
library(ggplot2)
library(maps)
library(spocc)
library(leaflet)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

First you need to import airline performance data.
```{r}
library(readr)
May17flight <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/May17flight.csv")

AirportData <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/AirportData.csv")

```

We can find some duplicated Data, Remove them
```{r}
AirportData_nd=AirportData[!duplicated(AirportData$Code),]
```

You can view the domestic airport list by use "unique"
```{r}
codeunique=data.frame(unique(May17flight$ORIGIN))
colnames(codeunique)="Code"
length(unique(May17flight$ORIGIN))
```

Obtain Airdata coordinate by "left-join"
```{r}
airport_joined=left_join(codeunique, AirportData_nd, by = "Code")

```

View the Location Map Use "Leaflet"
```{r}
leaflet() %>% addProviderTiles(providers$OpenStreetMap) %>% addMarkers(airport_joined$LONGITUDE,airport_joined$LATITUDE,popup=airport_joined$DISPLAY_AIRPORT_NAME,clusterOptions = markerClusterOptions())
```

ggplot
```{r}
p=ggplot(subset(May17flight,!is.na(DEP_DELAY_NEW)),aes(x=DISTANCE,y=DEP_DELAY_NEW))
p+geom_point(alpha=0.1)
p=ggplot(May17flight, aes(x = DISTANCE, y = DEP_DELAY_NEW, color = factor(CARRIER)))
p+geom_point(alpha=0.1)

```
Only View Three Major Airlines
```{r}
ggplot(subset(May17flight,CARRIER %in% c("AA","UA","DL")),aes(x = DISTANCE, y = DEP_DELAY_NEW, color = factor(CARRIER)))+ geom_point(alpha=0.3)
```


We are going to use the `occ()` function to download _occurrence_ records for the American robin (_Turdus migratorius_) from the [Global Biodiversity Information Facility](gbif.org).

<img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/Turdus-migratorius-002.jpg" alt="alt text" width="200">
<small><small><small>Licensed under CC BY-SA 3.0 via [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Turdus-migratorius-002.jpg#/media/File:Turdus-migratorius-002.jpg)</small></small></small>

```{r, warning=F} 
## define which species to query
sp='Turdus migratorius'

## run the query and convert to data.frame()
d = occ(query=sp, from='ebird',limit = 100) %>% occ2df()
```
This can take a few seconds.

```{r, fig.width=6, fig.height=3, fig.cap="Map illustrating the known occurrence locations"}
# Load coastline
map=map_data("world")

ggplot(d,aes(x=longitude,y=latitude))+
  geom_polygon(aes(x=long,y=lat,group=group),data=map)+
  geom_point(col="red")+
  coord_equal()
```


# Results

Show tables, plots, etc. and describe them.

# Conclusions

What have you learned?  Are there any broader implications?

# References

