---
title: "Demostic flight delay in May 2017"
author: "Zeping He"
subtitle: With the relationship of geographic...
output: pdf_document
---


# Introduction
With more and more people choose plane to travel, aviation industry have a significant growth on quantity of the travelers, so as the demand of the airplane. In the year of 2016, 3.8 billion air travelers fly all over the earth. The International Air Transport Association (IATA) expects 7.2 billion passengers to travel in 2035, a near doubling of air travelers in 2016. In a world of increasing transparency, immediate information and action, flight status and punctuality data has an increasingly important role to play in all of our planning. Everyone from the fuelling company to the catering supplier to the traveller wants access to timely, accurate information about the on-time performace. 
In my project, I will 

**Focus on US demostic airline on-time data of May 2017. Test the relationship between "Distance" and "Delay time"**

**How the severity of deplayed airport appears to have geographic pattern of distribution.**

The hypothsis toward this topic are a) as the flight distance increase, the percentage and the degree of delayed flight will increase, reason is long distance flight could be more affect by the Objective factors on the midway (i.e: weather conditions of the routing) before departure.  b) By the interactive maps shows, the geographic pattern will become a dominate. Similarities could be found in the regional group or cluster of the airport. 

> “People want to fly. Demand for air travel over the next two decades is set to double. Enabling people and nations to trade, explore, and share the benefits of innovation and economic prosperity makes our world a better place,”   ~ Alexandre de Juniac, IATA’s Director General and CEO. 


> “Punctuality is the soul of business” ~Thomas Chandler Halliburton 

# Materials and methods

Data Source:

* Filght on-time Performance --- from BUREAU OF TRANSPORTATION STATISTICS
* Airport Location Data --- BUREAU OF TRANSPORTATION STATISTICS

Poposed Mehod:

1. Data prepartion (Creat another dataframe by Merge two csv file )
2. General view the airport location distribubtion
3. Use ggplot to see the relationship between distance 

See [http://rmarkdown.rstudio.com/](http://rmarkdown.rstudio.com/) for all the amazing things you can do.

Load any required packages in a code chunk (you may need to install some packages):
# Data
```{r, message=F, warning=F}
library(dplyr)
library(ggplot2)
library(maps)
library(spocc)
library(leaflet)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

First you need to import airline performance data.
```{r}
library(readr)
May17flight <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/data/May17flight.csv")

AirportData <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/data/AirportData.csv")

```

We can find some duplicated Data, Remove them
```{r}
AirportData_nd=AirportData[!duplicated(AirportData$Code),]
```

You can view the domestic airport list by use "unique"
```{r}
codeunique=data.frame(unique(May17flight$ORIGIN))
colnames(codeunique)="Code"
length(unique(May17flight$ORIGIN))
```

Obtain Airdata coordinate by "left-join"
```{r}
airport_joined=left_join(codeunique, AirportData_nd, by = "Code")

```

View the Location Map Use "Leaflet"
```{r}
m1=leaflet(airport_joined) %>% 
   setView(-96, 37.8, 3) %>% 
   addProviderTiles(providers$CartoDB.PositronNoLabels) %>%  
   addMarkers(lng=~LONGITUDE,lat=~LATITUDE,
   popup=airport_joined$DISPLAY_AIRPORT_NAME,clusterOptions = markerClusterOptions())
m1
```

ggplot
```{r}
p=ggplot(subset(May17flight,!is.na(DEP_DELAY_NEW)),aes(x=DISTANCE,y=DEP_DELAY_NEW))
p+geom_point(alpha=0.1)
p=ggplot(May17flight, aes(x = DISTANCE, y = DEP_DELAY_NEW, color = factor(CARRIER)))
p+geom_point(alpha=0.1)

```


Only View Three Major Airlines
```{r}
ggplot(subset(May17flight,CARRIER %in% c("AA","UA","DL")),aes(x = DISTANCE, y = DEP_DELAY_NEW, color = factor(CARRIER)))+ geom_point(alpha=0.3)
```

View the monthly departure and arrival delay 

```{r}
monthlydata=aggregate(May17flight[, 20:21], list(May17flight$ORIGIN), mean,na.rm=T)
colnames(monthlydata)[colnames(monthlydata)=="Group.1"]="Code"
l2=left_join(monthlydata, AirportData_nd, by = "Code")
pal <- colorBin("YlOrRd", domain = l2$DEP_DELAY_NEW)

```


```{r}
m2=leaflet(l2) %>% 
    setView(-96, 37.8, 4) %>% 
    addProviderTiles(providers$CartoDB.Positron) %>%
    addCircleMarkers(color=~pal(l2$DEP_DELAY_NEW),popup = ~format(l2$DEP_DELAY_NEW))
m2
```

# Exceed 15mins of delay

```{r}
a=filter(l2,l2$DEP_DELAY_NEW>15)
pal2=colorQuantile("Blues", a$DEP_DELAY_NEW, n = 4)
```



```{r}
m3=leaflet(a) %>% 
    addProviderTiles(providers$CartoDB.Positron) %>% 
    addCircleMarkers(lng=a$LONGITUDE, lat=a$LATITUDE,color=~pal2(DEP_DELAY_NEW))
m3
```


# Results

Show tables, plots, etc. and describe them.

# Conclusions

What have you learned?  Are there any broader implications?

# References

