---
title: "Demostic flight delay in May 2017"
author: "Zeping He"
subtitle: With the relationship of geographic...
output: pdf_document
---


# Introduction
With more and more people choose the plane to travel, the world aviation industry has a significant growth in the quantity of the travelers, so as the demand of the airplane. In the year of 2016, 3.8 billion air travelers fly all over the earth. The International Air Transport Association (IATA) expects 7.2 billion passengers to travel in 2035, a near doubling of air travelers in 2016. In a world of increasing transparency, immediate information and action, flight status and punctuality data have an increasingly important role to play in all of our planning. Everyone from the fuelling company to the catering supplier to the traveler wants access to timely, accurate information about the on-time performance. In my project, I will 

**Focus on US domestic airline on-time data for May 2017. Test the relationship between "Distance" and "Delay time"**

**How the severity of delayed airport appears to have geographic pattern of distribution.**

The hypothesis of this topic are. a) as the flight distance increase, the percentage and the degree of delayed flight will increase. The reason is long distance flight could be more effective by the Objective factors on the midway (i.e: weather conditions of the routing) before departure.  b) By the interactive maps shows, the geographic pattern will become a dominate. Similarities could be found in the regional group or cluster of the airport. 

> “People want to fly. Demand for air travel over the next two decades is set to double. Enabling people and nations to trade, explore, and share the benefits of innovation and economic prosperity makes our world a better place,”   ~ Alexandre de Juniac, IATA’s Director General and CEO. 


> “Punctuality is the soul of business” ~Thomas Chandler Halliburton 

# Materials and methods

Data Source:

* Filght on-time Performance --- from BUREAU OF TRANSPORTATION STATISTICS
* Airport Location Data --- BUREAU OF TRANSPORTATION STATISTICS

Poposed Mehod:

1. Data prepartion (Creat another dataframe by Merge two csv file )
2. General view the airport location distribubtion
3. Use ggplot to see the relationship between distance 

See [http://rmarkdown.rstudio.com/](http://rmarkdown.rstudio.com/) for all the amazing things you can do.

Load any required packages in a code chunk (you may need to install some packages):
# Data
```{r, message=F, warning=F}
library(dplyr)
library(ggplot2)
library(maps)
library(spocc)
library(leaflet)
library(rbokeh)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

First you need to import airline performance data.
```{r, message=F, warning=F}
library(readr)
May17flight <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/data/May17flight.csv")

AirportData <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/data/AirportData.csv")

Halfflow <- read_csv("https://raw.githubusercontent.com/finallyegg/RDataScience_Project/master/data/Halfflow.csv")

```

We can find some duplicated Data, Remove them
```{r, message=F, warning=F}
AirportData_nd=AirportData[!duplicated(AirportData$Code),]
```

You can view the domestic airport list by use "unique"
```{r, warning=F}
codeunique=data.frame(unique(May17flight$ORIGIN))
colnames(codeunique)="Code"
length(unique(May17flight$ORIGIN))
```

Obtain Airdata coordinate by "left-join"
```{r, message=F, warning=F}
airport_joined=left_join(codeunique, AirportData_nd, by = "Code")

```
##Briefly view the distribution of the public airport
View the Location Map Use "Leaflet"
```{r, warning=F,message=F}
m1=leaflet(airport_joined) %>% 
   setView(-96, 37.8, 3) %>% 
   addProviderTiles(providers$CartoDB.PositronNoLabels) %>%  
   addMarkers(lng=~LONGITUDE,lat=~LATITUDE,
   popup=airport_joined$DISPLAY_AIRPORT_NAME,clusterOptions = markerClusterOptions())
m1
```

ggplot
{r, warning=F}
cutoffdelay <- data.frame( x = c(-Inf, Inf), y = 15, cutoff = factor(15) )
p=ggplot(subset(May17flight,!is.na(DEP_DELAY_NEW)),aes(x=DISTANCE,y=DEP_DELAY_NEW))
p+
   geom_point(alpha=0.1) +
   geom_line(aes( x, y, linetype = cutoff , colour="Blue"), cutoffdelay)+
   stat_summary(aes(y = DEP_DELAY_NEW,group=1), fun.y=mean, colour="red", geom="line",group=1)



### LOOKS HORRIBLE, NOT RUNNNING THIS

Only View Three Major Airlines

ggplot(subset(May17flight,CARRIER %in% c("AA","UA","DL")),aes(x = DISTANCE, y = 

DEP_DELAY_NEW, color = factor(CARRIER)))+ geom_point(alpha=0.3)


##View the monthly departure and arrival delay 
Hover on the point to view the avg.delay time

```{r, warning=F,message=F}
monthlydata=aggregate(May17flight[, 12:13], list(May17flight$ORIGIN), mean,na.rm=T)
colnames(monthlydata)[colnames(monthlydata)=="Group.1"]="Code"
l2=left_join(monthlydata, AirportData_nd, by = "Code")
pal <- colorBin("YlOrRd", domain = l2$DEP_DELAY_NEW)

```


```{r, warning=F,message=F}
popuplabels <- paste(l2$DISPLAY_AIRPORT_NAM,"Airport",
                 "<br>Average Delay Here is</br>",round(l2$DEP_DELAY_NEW),"minutes")

m2=leaflet(finished) %>% 
  setView(-96, 37.8, 4) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(color=~pal(finished$DEP_DELAY_NEW),popup = popuplabels,radius = ~sqrt(finished$Flow)*0.01)
m2
```

## Exceed 15mins of delay
Hover on the point to view the avg.delay time

```{r, warning=F}
a=filter(l2,l2$DEP_DELAY_NEW>15) 
pal2=colorQuantile("Blues", a$DEP_DELAY_NEW, n = 4)
```



```{r, warning=F}
m3=leaflet(a) %>% 
    addProviderTiles(providers$CartoDB.Positron) %>% 
    addCircleMarkers(lng=a$LONGITUDE, lat=a$LATITUDE,color=~pal2(DEP_DELAY_NEW),popup = popuplabels,radius = ~sqrt(finished$Flow))
m3
```

## Relationship between Punctuality rate and Passager flow
```{r, warning=F,message=F}
g2=May17flight %>%
    group_by(ORIGIN) %>%
    summarise(perDelay =   
    length(DEP_DELAY_NEW[DEP_DELAY_NEW<=15])/length(DEP_DELAY_NEW))

g2a=left_join(g2,Halfflow,by = "ORIGIN")
g2a50=head(arrange(g2a,desc(Flow)), n = 50)
#ggplot(g2a,aes(x = perDelay, y = Flow)) +geom_point() + labs(x="Punctuality rate",y="Passager flow")
```

##Good looking and interactive Plot 
```{r, warning=F,message=F}
figure() %>% ly_points(perDelay,Flow,data=g2a, hover=Description)
figure() %>% ly_points(perDelay,Flow,data=g2a50, hover=list(Description,Flow,perDelay))
```

# Results

Show tables, plots, etc. and describe them.

# Conclusions

What have you learned?  Are there any broader implications?

# References

